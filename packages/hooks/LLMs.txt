# Orderly Network Hooks Library (@orderly.network/hooks)

> AI-optimized documentation for the Orderly Network React hooks library
> Version: 2.8.0
> Last Updated: 2025-10-17

## Overview

This is the core React hooks library for Orderly Network, providing a comprehensive suite of custom hooks for building decentralized trading and DeFi applications. Built with React, TypeScript, SWR, and Zustand, it enables seamless integration with blockchain networks, real-time data streams, and trading functionality.

## Core Principles

1. **Real-Time First**: WebSocket-based hooks for live market data, positions, and orders
2. **Type-Safe**: Full TypeScript support with exported types for all hooks
3. **Data Fetching**: Built on SWR for efficient data fetching and caching
4. **State Management**: Zustand for predictable and performant state management
5. **Blockchain Agnostic**: Support for EVM and Solana chains with adapter pattern
6. **Composable**: Hooks designed to work together seamlessly
7. **Performance**: Optimized with proper React patterns, memoization, and debouncing

## Technical Stack

### Core Dependencies
- **React**: ^18.x (peer dependency)
- **SWR**: 2.2.4 for data fetching and caching
- **Zustand**: ^4.5.5 for state management
- **Immer**: ^10.1.1 for immutable state updates
- **Lodash**: ^4.17.21 utility functions
- **Ramda**: ^0.29.0 functional programming utilities
- **use-debounce**: ^9.0.4 for debounced values

### Orderly Network Dependencies
- **@orderly.network/core**: Core SDK functionality
- **@orderly.network/net**: Network and WebSocket utilities
- **@orderly.network/perp**: Perpetual futures calculations
- **@orderly.network/types**: TypeScript type definitions
- **@orderly.network/utils**: Shared utilities
- **@orderly.network/default-evm-adapter**: EVM chain adapter
- **@orderly.network/default-solana-adapter**: Solana adapter
- **@orderly.network/web3-provider-ethers**: Ethers.js provider

### Analytics & Tracking
- **@amplitude/analytics-browser**: 2.11.13 for event tracking

### Build Tools
- **TypeScript**: ^5.1.6
- **tsup**: ^7.1.0 for bundling
- **Jest**: ^29.6.1 for testing (but project uses Vitest) [[memory:3047001]]

## Architecture

```
packages/hooks/
├── src/
│   ├── orderly/              # Core Orderly Network hooks
│   │   ├── useAccountInfo.ts
│   │   ├── useMarket.ts, useMarkets.ts
│   │   ├── useOrderbookStream.ts
│   │   ├── usePositionStream/
│   │   ├── useOrderStream/
│   │   ├── useMarkPrice.ts, useIndexPrice.ts
│   │   ├── useFundingRate.ts, useFundingRates.ts
│   │   ├── useChains.ts, useChain.ts
│   │   ├── useDeposit.ts, useWithdraw.ts
│   │   ├── useTransfer.ts, useConvert.ts
│   │   ├── useLeverage.ts, useMaxLeverage.ts
│   │   ├── useCollateral.ts, useMarginRatio.ts
│   │   ├── useMaintenanceStatus.ts
│   │   ├── calculator/       # Trading calculations
│   │   ├── statistics/       # Historical data hooks
│   │   ├── wsTopic/          # WebSocket topic hooks
│   │   └── appStore.ts       # Global app state
│   ├── referral/             # Referral program hooks
│   ├── trading-rewards/      # Trading rewards hooks
│   ├── subAccount/           # Sub-account management
│   ├── apiKeys/              # API key management
│   ├── next/                 # Next-gen hooks (experimental)
│   │   ├── useOrderEntry/    # New order entry hooks
│   │   └── positions/        # Position management
│   ├── services/             # Service layer
│   │   ├── orderCreator/     # Order creation service
│   │   ├── orderMerge/       # Order merging logic
│   │   ├── painter/          # Chart/canvas utilities
│   │   └── amplitudeTracker.ts
│   ├── provider/             # Context providers
│   │   ├── dataCenter/       # Data center context
│   │   ├── status/           # Status provider
│   │   └── store/            # Store provider
│   ├── shared/               # Shared utilities
│   │   ├── useMemoizedFn.ts
│   │   ├── useUpdatedRef.ts
│   │   └── useAudio.tsx
│   ├── utils/                # Utility functions
│   ├── deprecated/           # Legacy hooks
│   ├── middleware/           # SWR middleware
│   ├── orderlyContext.tsx    # Main Orderly context
│   ├── configProvider.tsx    # Configuration provider
│   ├── walletConnectorContext.tsx
│   ├── useAccount.ts         # Account management
│   ├── useQuery.ts           # Base query hook
│   ├── usePrivateQuery.ts    # Authenticated queries
│   ├── useMutation.ts        # Mutation hook
│   ├── useWS.ts              # WebSocket hook
│   ├── useLocalStorage.ts
│   ├── useSessionStorage.ts
│   └── useMediaQuery.ts
└── typedoc.json
```

## Hook Categories

### Account & Authentication Hooks
- **useAccount**: Main account hook for authentication and account state
- **useAccountInstance**: Access the underlying account SDK instance
- **useAccountInfo**: Fetch account information (balances, PnL, etc.)
- **useWalletConnector**: Wallet connection state and actions
- **useKeyStore**: Manage API keys and authentication

### Market Data Hooks
- **useMarket**: Fetch single market/symbol data
- **useMarkets**: Fetch all available markets with favorites/recent
- **useMarketsStream**: Real-time market data stream (24h change, volume, etc.)
- **useSymbolsInfo**: Fetch trading symbol configurations
- **useSymbolInfo**: Fetch single symbol configuration
- **useMarkPrice**: Get mark price for a symbol
- **useMarkPricesStream**: Real-time mark prices stream
- **useIndexPrice**: Get index price for a symbol
- **useIndexPricesStream**: Real-time index prices stream
- **useTickerStream**: Real-time ticker updates
- **useOpenInterest**: Open interest data

### Order Book & Trades Hooks
- **useOrderbookStream**: Real-time order book data
- **useMarketTradeStream**: Real-time market trades stream

### Position & Order Hooks
- **usePositionStream**: Real-time positions stream
- **useOrderStream**: Real-time orders stream
- **useTPSLOrder**: Take profit / stop loss order management
- **usePositionClose**: Close position functionality
- **useOrderEntry_deprecated**: Legacy order entry (deprecated)
- **useOrderEntryNext**: Next-gen order entry hooks

### Trading Calculations Hooks
- **useCollateral**: Calculate collateral requirements
- **useMaxQty**: Calculate maximum order quantity
- **useMarginRatio**: Get current margin ratio
- **useMaxLeverage**: Get maximum allowed leverage
- **useSymbolLeverage**: Get leverage for a symbol
- **useLeverageBySymbol**: Manage leverage by symbol
- **useLeverage**: Global leverage management
- **useSymbolPriceRange**: Get valid price range for a symbol
- **useComputedLTV**: Calculate Loan-to-Value ratio

### Funding & Fees Hooks
- **useFundingRate**: Current funding rate for a symbol
- **useFundingRates**: All funding rates
- **useFundingDetails**: Detailed funding information
- **useFundingRateHistory**: Historical funding rates
- **useFeeState**: Trading fee information

### Asset Management Hooks
- **useDeposit**: Deposit assets to Orderly
- **useWithdraw**: Withdraw assets from Orderly
- **useTransfer**: Transfer between accounts
- **useInternalTransfer**: Internal transfers
- **useConvert**: Asset conversion functionality
- **useMaxWithdrawal**: Calculate maximum withdrawal amount
- **useOdosQuote**: Get quotes from Odos aggregator

### Chain & Network Hooks
- **useChains**: Fetch all supported chains
- **useChain**: Get specific chain information
- **useChainInfo**: Detailed chain configuration
- **useStorageChain**: Persist selected chain
- **useNetworkInfo**: Network configuration and endpoints

### WebSocket & Real-Time Hooks
- **useWS**: Base WebSocket hook
- **useWsStatus**: WebSocket connection status
- **useHoldingStream**: Real-time holdings updates
- **useWalletSubscription**: Wallet balance updates
- **useBalanceSubscription**: Balance change notifications
- **useSettleSubscription**: Settlement notifications
- **usePrivateDataObserver**: Monitor private data streams
- **usePublicDataObserver**: Monitor public data streams
- **useWalletTopic**: Wallet WebSocket topic
- **useBalanceTopic**: Balance WebSocket topic

### Historical Data Hooks
- **useAssetsHistory**: Asset history over time
- **useStatisticsDaily**: Daily trading statistics
- **useFundingFeeHistory**: Historical funding fees
- **useDistributionHistory**: Distribution history
- **useTransferHistory**: Transfer history
- **useVaultsHistory**: Vault activity history

### Referral Program Hooks
- **useReferralInfo**: Referral program information
- **useCheckReferralCode**: Validate referral code
- **useGetReferralCode**: Get user's referral code
- **useCommission**: Commission data
- **useDaily**: Daily referral stats
- **useDistribution**: Referral distributions
- **useRefereeHistory**: Referee activity
- **useRefereeInfo**: Referee information
- **useRefereeRebateSummary**: Referee rebate summary
- **useReferralRebateSummary**: Referral rebate summary

### Trading Rewards Hooks
- Trading rewards and incentive hooks (exported from `./trading-rewards`)

### Sub-Account Hooks
- **useSubAccountQuery**: Query sub-account data
- **useSubAccountMutation**: Mutate sub-account data
- **useSubAccountWS**: Sub-account WebSocket streams
- **useSubAccountDataObserver**: Monitor sub-account data
- **useSubAccountMaxWithdrawal**: Max withdrawal for sub-accounts

### API Key Management Hooks
- **useApiKeyManager**: Manage API keys (exported from `./apiKeys`)

### Utility Hooks
- **useQuery**: Base SWR query hook with Orderly config
- **useLazyQuery**: Lazy-loaded query
- **usePrivateQuery**: Authenticated SWR query
- **useMutation**: Mutation hook for POST/PUT/DELETE
- **useInfiniteQuery**: Infinite scroll query
- **usePrivateInfiniteQuery**: Authenticated infinite query
- **useBoolean**: Boolean state management
- **useMediaQuery**: Media query matching
- **useLocalStorage**: Local storage with React state
- **useSessionStorage**: Session storage with React state
- **useEventEmitter**: Event emitter for cross-component communication
- **usePreLoadData**: Pre-load data before render
- **useTrack**: Analytics tracking
- **useTrackingInstance**: Access tracking instance
- **usePoster**: Canvas/image poster generation
- **useAudioPlayer**: Audio playback management
- **useMemoizedFn**: Memoized function reference
- **useUpdatedRef**: Keep ref updated with latest value
- **useConstant**: Re-exported from `use-constant`

### Maintenance & Status Hooks
- **useMaintenanceStatus**: Check maintenance status of system/chains

### Configuration & Provider Hooks
- **useConfig**: Access Orderly configuration
- **OrderlyConfigProvider**: Configuration provider component
- **useRestrictedInfo**: Check geographic/regulatory restrictions

### Store Hooks (Zustand)
- **useMarketsStore**: Markets state store
- **useMarkPriceBySymbol**: Mark price store accessor
- **usePositionActions**: Position state actions
- **useStorageLedgerAddress**: Persist ledger address
- **useTokensInfo**: Token information store
- **useTokenInfo**: Single token info accessor
- **useSymbolsInfoStore**: Symbols info store
- **useFundingRatesStore**: Funding rates store
- **usePortfolio**: Portfolio state and calculations
- **useFundingRateBySymbol**: Funding rate by symbol accessor
- **useMarketList**: Market list from store
- **useMarketMap**: Market map from store

## Usage Patterns

### Installation & Setup

```typescript
// Install the package
pnpm add @orderly.network/hooks

// Wrap your app with providers
import { OrderlyConfigProvider } from '@orderly.network/hooks';

function App() {
  return (
    <OrderlyConfigProvider
      networkId="mainnet"
      brokerId="your_broker_id"
    >
      {/* Your app components */}
    </OrderlyConfigProvider>
  );
}
```

### Account Management

```typescript
import { useAccount } from '@orderly.network/hooks';

function AccountComponent() {
  const { account, state } = useAccount();
  
  // Account states: Idle, NotConnected, Connecting, Connected, SignedIn
  console.log('Account state:', state.status);
  
  return (
    <div>
      {account.address && <p>Address: {account.address}</p>}
    </div>
  );
}
```

### Market Data

```typescript
import { useMarkets, useSymbolsInfo } from '@orderly.network/hooks';

function MarketList() {
  const { data: markets, isLoading } = useMarkets();
  const { data: symbolsInfo } = useSymbolsInfo();
  
  if (isLoading) return <div>Loading markets...</div>;
  
  return (
    <div>
      {markets?.map(market => (
        <div key={market.symbol}>
          {market.symbol}: ${market.close}
        </div>
      ))}
    </div>
  );
}
```

### Real-Time Order Book

```typescript
import { useOrderbookStream } from '@orderly.network/hooks';

function OrderBook({ symbol }: { symbol: string }) {
  const [data] = useOrderbookStream(symbol, undefined, {
    level: 7 // Order book depth level
  });
  
  return (
    <div>
      <div>Asks: {data?.asks?.length}</div>
      <div>Bids: {data?.bids?.length}</div>
    </div>
  );
}
```

### Position Monitoring

```typescript
import { usePositionStream } from '@orderly.network/hooks';

function Positions() {
  const [positions, info] = usePositionStream({
    calcMode: 'mark_price' // or 'last_price'
  });
  
  return (
    <div>
      <div>Total Unrealized PnL: {info.unrealPnL}</div>
      <div>Total Notional: {info.notional}</div>
      {positions?.map(position => (
        <div key={position.symbol}>
          {position.symbol}: {position.position_qty}
        </div>
      ))}
    </div>
  );
}
```

### Deposits & Withdrawals

```typescript
import { useDeposit, useWithdraw } from '@orderly.network/hooks';

function AssetManagement() {
  const { deposit } = useDeposit();
  const { withdraw } = useWithdraw();
  
  const handleDeposit = async () => {
    try {
      const result = await deposit({
        token: 'USDC',
        amount: 100,
        chainId: 42161 // Arbitrum
      });
      console.log('Deposit successful:', result);
    } catch (error) {
      console.error('Deposit failed:', error);
    }
  };
  
  const handleWithdraw = async () => {
    try {
      const result = await withdraw({
        token: 'USDC',
        amount: 50,
        chainId: 42161
      });
      console.log('Withdrawal successful:', result);
    } catch (error) {
      console.error('Withdrawal failed:', error);
    }
  };
  
  return (
    <div>
      <button onClick={handleDeposit}>Deposit 100 USDC</button>
      <button onClick={handleWithdraw}>Withdraw 50 USDC</button>
    </div>
  );
}
```

### Trading Calculations

```typescript
import { 
  useMaxQty, 
  useCollateral, 
  useMarginRatio 
} from '@orderly.network/hooks';

function TradingCalculations({ symbol }: { symbol: string }) {
  const { maxQty } = useMaxQty(symbol, 'LONG');
  const { data: collateral } = useCollateral();
  const { currentLeverage } = useMarginRatio();
  
  return (
    <div>
      <div>Max Quantity: {maxQty}</div>
      <div>Free Collateral: {collateral?.freeCollateral}</div>
      <div>Current Leverage: {currentLeverage}x</div>
    </div>
  );
}
```

### Leverage Management

```typescript
import { useLeverage, useMaxLeverage } from '@orderly.network/hooks';

function LeverageControl({ symbol }: { symbol: string }) {
  const [leverage, { update }] = useLeverage();
  const { maxLeverage } = useMaxLeverage(symbol);
  
  const handleLeverageChange = async (newLeverage: number) => {
    try {
      await update(newLeverage);
      console.log('Leverage updated to', newLeverage);
    } catch (error) {
      console.error('Failed to update leverage:', error);
    }
  };
  
  return (
    <div>
      <div>Current: {leverage}x</div>
      <div>Max: {maxLeverage}x</div>
      <input 
        type="range" 
        min={1} 
        max={maxLeverage}
        value={leverage}
        onChange={(e) => handleLeverageChange(Number(e.target.value))}
      />
    </div>
  );
}
```

### Chain Management

```typescript
import { useChains, useChain } from '@orderly.network/hooks';

function ChainSelector() {
  const { data: chains } = useChains({
    filter: (chain) => chain.network_infos?.bridge_enable
  });
  const [currentChain, { setChain }] = useChain();
  
  return (
    <select 
      value={currentChain?.id} 
      onChange={(e) => setChain(Number(e.target.value))}
    >
      {chains?.map(chain => (
        <option key={chain.id} value={chain.id}>
          {chain.name}
        </option>
      ))}
    </select>
  );
}
```

### WebSocket Status

```typescript
import { useWsStatus, WsNetworkStatus } from '@orderly.network/hooks';

function ConnectionStatus() {
  const { status } = useWsStatus();
  
  return (
    <div>
      Status: {status === WsNetworkStatus.CONNECTED ? 'Connected' : 'Disconnected'}
    </div>
  );
}
```

### Event Tracking

```typescript
import { useTrack } from '@orderly.network/hooks';

function TrackableButton() {
  const { track } = useTrack();
  
  const handleClick = () => {
    track('button_clicked', {
      button_name: 'deposit',
      page: 'trading'
    });
  };
  
  return <button onClick={handleClick}>Deposit</button>;
}
```

### Local Storage Persistence

```typescript
import { useLocalStorage } from '@orderly.network/hooks';

function ThemeSelector() {
  const [theme, setTheme] = useLocalStorage('app-theme', 'dark');
  
  return (
    <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}>
      Current: {theme}
    </button>
  );
}
```

## TypeScript Support

### Exported Types

```typescript
import type {
  // Account types
  WalletState,
  WalletConnectorContextState,
  ConnectedChain,
  SubAccount,
  
  // Market types
  MarketsItem,
  MarketsStore,
  FavoriteTab,
  Favorite,
  Recent,
  NewListing,
  SymbolsInfo,
  
  // Order book types
  OrderbookData,
  OrderBookItem,
  OrderbookOptions,
  
  // Position types
  PriceMode,
  
  // Trading types
  CollateralOutputs,
  MarginRatioReturn,
  ComputedAlgoOrder,
  
  // Chain types
  Chain,
  Chains,
  UseChainsOptions,
  UseChainsReturnObject,
  
  // Order entry types
  UseOrderEntryMetaState,
  OrderParams,
  
  // Config types
  ConfigProviderProps,
  ExclusiveConfigProviderProps,
  ChainFilter,
  
  // Referral types
  RefferalAPI,
  
  // Restriction types
  RestrictedInfoReturns,
  RestrictedInfoOptions,
  
  // SWR types
  SWRConfiguration,
  SWRHook,
  SWRResponse,
  Middleware,
  KeyedMutator,
  
  // Utility types
  useQueryOptions,
  PosterLayoutConfig,
  DrawOptions,
  
  // Core SDK types
  WalletAdapter,
} from '@orderly.network/hooks';
```

### Hook Return Type Examples

```typescript
import { useAccount, useMarkets, usePositionStream } from '@orderly.network/hooks';

// Account hook returns
const { 
  account,      // Account information
  state,        // Connection state
  createAccount,
  createOrderlyKey,
  settle
} = useAccount();

// Markets hook returns (SWR response)
const { 
  data,         // Markets data
  error,        // Error object
  isLoading,    // Loading state
  isValidating, // Revalidation state
  mutate        // Manual revalidation
} = useMarkets();

// Position stream returns tuple
const [positions, info, meta] = usePositionStream();
// positions: Array of position objects
// info: Aggregated position info (PnL, notional, etc.)
// meta: Metadata about the stream
```

## Best Practices

### 1. Always Use Configuration Provider

Wrap your application with `OrderlyConfigProvider`:

```typescript
import { OrderlyConfigProvider } from '@orderly.network/hooks';

<OrderlyConfigProvider
  networkId="mainnet"
  brokerId="your_broker_id"
  brokerName="Your Platform"
>
  <App />
</OrderlyConfigProvider>
```

### 2. Handle Account States Properly

Always check account state before performing actions:

```typescript
const { state } = useAccount();

if (state.status !== 'SignedIn') {
  return <div>Please connect wallet</div>;
}

// Safe to use trading hooks
```

### 3. Use WebSocket Hooks for Real-Time Data

Prefer WebSocket hooks over polling for real-time data:

```typescript
// ✅ Good - Real-time updates
const [positions] = usePositionStream();

// ❌ Avoid - Unnecessary polling
const { data: positions } = useQuery('/positions', {
  refreshInterval: 1000
});
```

### 4. Leverage Store Hooks for Global State

Use Zustand store hooks for frequently accessed data:

```typescript
// Direct access to mark price without prop drilling
const markPrice = useMarkPriceBySymbol('PERP_BTC_USDC');
```

### 5. Proper Error Handling

Always handle errors from async operations:

```typescript
const { deposit } = useDeposit();

try {
  await deposit({ token: 'USDC', amount: 100 });
} catch (error) {
  // Handle error appropriately
  console.error('Deposit failed:', error);
  toast.error('Deposit failed. Please try again.');
}
```

### 6. Use Memoization Hooks

Utilize provided memoization hooks for stable references:

```typescript
import { useMemoizedFn } from '@orderly.network/hooks';

const handleClick = useMemoizedFn(() => {
  // Function body
});

// handleClick reference is stable across renders
```

### 7. Debounce User Input

Use debouncing for user input to reduce API calls:

```typescript
import { useDebounce } from '@orderly.network/hooks';

const [searchTerm, setSearchTerm] = useState('');
const debouncedSearch = useDebounce(searchTerm, 500);

// Use debouncedSearch in API calls
```

### 8. Clean Up Side Effects

WebSocket hooks automatically clean up, but be mindful of custom event listeners and timers:

```typescript
useEffect(() => {
  const handleEvent = (event) => {
    console.log('Event received:', event);
  };
  
  window.addEventListener('resize', handleEvent);
  
  return () => {
    window.removeEventListener('resize', handleEvent);
  };
}, []);
```

### 9. Type Safety with Symbols

Always use proper symbol format (e.g., 'PERP_BTC_USDC'):

```typescript
// ✅ Correct
const orderbook = useOrderbookStream('PERP_BTC_USDC');

// ❌ Incorrect
const orderbook = useOrderbookStream('BTC-USDC'); // Wrong format
```

### 10. Optimize Re-Renders

Use selectors or memoization to prevent unnecessary re-renders:

```typescript
const totalPnL = usePositionStream((state) => state.info.unrealPnL);
// Only re-renders when unrealPnL changes
```

## Development Guidelines

### Component Creation Using Hooks

When using hooks in components:

1. **Import hooks from the package** rather than implementing custom solutions
2. **Follow React hooks rules** (only call at top level, only in React functions)
3. **Use JSDoc comments** for custom hooks
4. **Export types** for hook return values
5. **Handle loading and error states** properly
6. **Write tests before implementation** [[memory:3019470]]
7. **Use Node assert for assertions** in tests [[memory:2356964]]

### Commenting Standards

```typescript
/**
 * Fetches and subscribes to real-time position updates
 * 
 * @param options - Configuration options for position calculations
 * @param options.calcMode - Price mode for PnL calculations ('mark_price' or 'last_price')
 * @returns Tuple of [positions, aggregatedInfo, metadata]
 * 
 * @example
 * const [positions, info] = usePositionStream({ calcMode: 'mark_price' });
 * console.log('Total PnL:', info.unrealPnL);
 */
export const usePositionStream = (options?: PositionStreamOptions) => {
  // Implementation
};
```

### Testing

- Test framework: Vitest (project standard) [[memory:3047001]]
- Use Node `assert` for assertions [[memory:2356964]]
- Write tests before implementing features [[memory:3019470]]
- Focus on hook behavior and edge cases
- Mock WebSocket connections appropriately

### Build Process

```bash
# Install dependencies (use pnpm)
pnpm install

# Build the library
pnpm build

# Run tests
pnpm test

# Watch mode for development
pnpm dev
```

## Common Patterns

### Combining Multiple Hooks

```typescript
function TradingWidget({ symbol }: { symbol: string }) {
  const { state } = useAccount();
  const [orderbook] = useOrderbookStream(symbol);
  const [positions] = usePositionStream();
  const { maxQty } = useMaxQty(symbol, 'LONG');
  const [leverage] = useLeverage();
  
  if (state.status !== 'SignedIn') {
    return <ConnectWallet />;
  }
  
  return (
    <div>
      <OrderBook data={orderbook} />
      <PositionsList positions={positions} />
      <OrderForm maxQty={maxQty} leverage={leverage} />
    </div>
  );
}
```

### Conditional Data Fetching

```typescript
function UserData() {
  const { state } = useAccount();
  
  // Only fetch when signed in
  const { data: accountInfo } = useAccountInfo({
    enabled: state.status === 'SignedIn'
  });
  
  return accountInfo ? (
    <div>Balance: {accountInfo.totalValue}</div>
  ) : null;
}
```

### Polling vs Streaming

```typescript
// Polling - for less frequent updates
const { data: fundingRate } = useFundingRate(symbol, {
  refreshInterval: 10000 // Poll every 10 seconds
});

// Streaming - for real-time updates
const [marketsData] = useMarketsStream();
```

### Optimistic Updates

```typescript
const { data: positions, mutate } = usePositions();
const { closePosition } = usePositionClose();

const handleClose = async (symbol: string) => {
  // Optimistic update
  mutate(
    positions?.filter(p => p.symbol !== symbol),
    false // Don't revalidate yet
  );
  
  try {
    await closePosition(symbol);
    // Revalidate after success
    mutate();
  } catch (error) {
    // Revert on error
    mutate();
  }
};
```

## SWR Configuration

The hooks library extends SWR with Orderly-specific configuration:

```typescript
import { useSWRConfig } from '@orderly.network/hooks';

function CustomSWRComponent() {
  const { mutate, cache } = useSWRConfig();
  
  // Manually revalidate all queries
  mutate(() => true);
  
  return null;
}
```

### Custom SWR Middleware

```typescript
import { signatureMiddleware } from '@orderly.network/hooks';

// Applied automatically to private queries
```

## Utility Functions

The package exports several utility functions:

```typescript
import { 
  cleanStringStyle,
  checkNotional,
  getMinNotional,
  parseJSON,
  fetcher,
  utils
} from '@orderly.network/hooks';

// Check if order meets minimum notional
const isValid = checkNotional(price, quantity, minNotional);

// Get minimum notional for symbol
const minNotional = getMinNotional(symbolInfo);

// Parse JSON safely
const data = parseJSON(jsonString, defaultValue);
```

## Re-exported Libraries

The package re-exports several libraries for convenience:

```typescript
// SWR
export { 
  useSWR, 
  useSWRConfig, 
  unstable_serialize,
  type SWRConfiguration,
  type SWRResponse 
} from '@orderly.network/hooks';

// use-debounce
export { useDebounce, useDebouncedCallback } from '@orderly.network/hooks';

// use-constant
export { useConstant } from '@orderly.network/hooks';

// All SWR utilities
import { swr } from '@orderly.network/hooks';
```

## Performance Considerations

1. **WebSocket Efficiency**: WebSocket hooks share connections automatically
2. **SWR Caching**: Leverage SWR's built-in caching and deduplication
3. **Zustand Performance**: Store hooks only trigger re-renders on actual changes
4. **Debouncing**: Use debounce hooks for user input
5. **Memoization**: Use `useMemoizedFn` for stable function references
6. **Selective Subscriptions**: Only subscribe to data you actually need

## Migration Notes

### From v2.7 to v2.8

Check CHANGELOG.md for detailed breaking changes. Key changes may include:
- New hooks for enhanced functionality
- Updated TypeScript types
- Performance improvements
- Bug fixes

### Deprecated Hooks

- **useOrderEntry**: Use `useOrderEntryNext` from `./next/useOrderEntry` instead

## Related Packages

This hooks library is used by several other Orderly Network packages:

- `@orderly.network/trading`: Trading interface
- `@orderly.network/markets`: Market data UI
- `@orderly.network/portfolio`: Portfolio management
- `@orderly.network/ui-orders`: Order management UI
- `@orderly.network/ui-positions`: Position management UI
- `@orderly.network/ui-order-entry`: Order entry forms
- `@orderly.network/ui-connector`: Wallet connection
- And many more...

## Dependencies Chain

```
@orderly.network/hooks depends on:
├── @orderly.network/core (SDK core)
├── @orderly.network/net (Network layer)
├── @orderly.network/types (Type definitions)
├── @orderly.network/utils (Utilities)
├── @orderly.network/perp (Perpetual calculations)
├── @orderly.network/default-evm-adapter
└── @orderly.network/default-solana-adapter
```

## Support & Resources

- Package: `@orderly.network/hooks`
- Version: 2.8.0
- Author: orderly.network
- License: Check package.json
- Dependencies: See package.json for full list

## Key Files to Reference

- `/packages/hooks/src/index.ts` - Main export file
- `/packages/hooks/src/orderly/orderlyHooks.ts` - Orderly hooks exports
- `/packages/hooks/src/configProvider.tsx` - Configuration provider
- `/packages/hooks/src/orderlyContext.tsx` - Main context
- `/packages/hooks/CHANGELOG.md` - Version history
- `/packages/hooks/package.json` - Package configuration

## Common Integration Issues

### 1. Provider Not Found

**Problem**: "Cannot read properties of undefined"

**Solution**: Ensure `OrderlyConfigProvider` wraps your app:

```typescript
<OrderlyConfigProvider networkId="mainnet" brokerId="your_id">
  <App />
</OrderlyConfigProvider>
```

### 2. WebSocket Connection Fails

**Problem**: Real-time hooks not receiving data

**Solution**: Check network configuration and account authentication state

### 3. Type Errors with Symbols

**Problem**: Type errors when passing symbol strings

**Solution**: Use proper symbol format: `'PERP_BTC_USDC'` not `'BTC-USDC'`

### 4. Stale Data

**Problem**: Data not updating

**Solution**: Use `mutate()` to manually trigger revalidation or check `refreshInterval` settings

## Testing Examples

```typescript
import { renderHook, waitFor } from '@testing-library/react';
import { useMarkets } from '@orderly.network/hooks';
import assert from 'node:assert';

describe('useMarkets', () => {
  it('fetches markets data', async () => {
    const { result } = renderHook(() => useMarkets());
    
    await waitFor(() => {
      assert(result.current.data !== undefined);
    });
    
    assert(Array.isArray(result.current.data));
  });
});
```

---

This documentation is optimized for AI assistants. When helping developers:

1. Always check if a hook exists before implementing custom solutions
2. Follow established patterns for data fetching and state management
3. Use TypeScript types for better code completion and error checking
4. Leverage the built-in hooks rather than third-party alternatives
5. Refer to specific hook files for implementation details
6. Remember to handle loading and error states appropriately
7. Prefer WebSocket hooks for real-time data over polling
8. Use store hooks for global state that needs to be accessed across components
9. Use pnpm for package management [[memory:2341487]]

